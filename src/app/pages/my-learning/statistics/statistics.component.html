<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@400;700&family=Roboto&display=swap" rel="stylesheet">

<div class="container">
    <div class="course-container">
        <!-- Sidebar c·ªë ƒë·ªãnh b√™n ph·∫£i -->
        <div class="sidebar">
            <div class="course-price">
                <span *ngIf="course.price && course.price !== 0; else freePrice">
                    {{ course.price | currency: 'VND':'symbol':'1.0-0':'vi-VN' }}
                </span>
                <ng-template #freePrice>Mi·ªÖn ph√≠</ng-template>
            </div>
            <div class="course-info-side">
                <p><strong>Th√¥ng tin kh√≥a h·ªçc</strong></p>
                <p>S·ªë b√†i h·ªçc: {{ lessons.length || 0 }}</p>
            </div>
            <button nz-button nzType="primary" (click)="goToStudy()">
                V√†o h·ªçc
            </button>
        </div>
        <div class="course-header">
            <div class="course-info">
                <img [src]="course.avatarUrl" alt="{{ course.title }}">
            </div>
            <div class="course-banner">
                <h1>{{ course.title }}</h1>
                <div class="keyword-container" *ngIf="course.keywords">
                    <span class="keyword-pill" *ngFor="let keyword of keywordList">
                        {{ keyword }}
                    </span>
                </div>

                <div class="course-meta">
                    <span>ƒê·ªô kh√≥: {{ course.difficulty || "Kh√¥ng x√°c ƒë·ªãnh" }}</span>
                </div>
                <nz-progress [nzPercent]="course.progress || 0" [nzStrokeWidth]="6" [nzShowInfo]="true">
                </nz-progress>
            </div>
        </div>

        <div class="lesson-container">
            <h3>üìö Danh s√°ch b√†i h·ªçc</h3>
            <nz-list *ngIf="lessons.length > 0" [nzBordered]="true" class="lesson-list">
                <nz-list-item *ngFor="let lesson of lessons; let i = index" class="lesson-row" (click)="selectLesson(lesson)">

                    <!-- C·ªôt 1: T√™n b√†i h·ªçc -->
                    <div class="lesson-title">
                        <nz-list-item-meta [nzAvatar]="lessonIcon" [nzTitle]="'B√†i ' + (i + 1) + ': ' + lesson.title">
                        </nz-list-item-meta>
                    </div>

                    <!-- C·ªôt 2: Tr·∫°ng th√°i ho√†n th√†nh & ƒêi·ªÉm s·ªë -->
                    <div class="lesson-status">
                        <span class="completed-status" [class.completed]="lesson.isCompleted">
                            {{ lesson.isCompleted ? '‚úÖ Ho√†n th√†nh' : '‚ùå Ch∆∞a ho√†n th√†nh' }}
                        </span>
                        <span class="lesson-score">
                                üèÜ {{ lesson.assignmentScore !== null ? lesson.assignmentScore : '--' }}
                        </span>
                    </div>

                </nz-list-item>
            </nz-list>

            <p *ngIf="lessons.length === 0" class="no-lessons">‚ùå Ch∆∞a c√≥ b√†i h·ªçc n√†o!</p>
        </div>

        <ng-template #lessonIcon>
            <i nz-icon nzType="book" nzTheme="outline"></i>
        </ng-template>

        <!-- Hi·ªÉn th·ªã b√†i ki·ªÉm tra cu·ªëi kh√≥a -->
        <div *ngIf="testName" class="test-info">
            <h3>üìù B√†i ki·ªÉm tra cu·ªëi kh√≥a: {{ testName }}</h3>
            <p *ngIf="testScore !== null">üèÜ ƒêi·ªÉm s·ªë c·ªßa b·∫°n: <strong>{{ testScore }}/100</strong></p>
            <p *ngIf="testScore === null">üîî B·∫°n ch∆∞a l√†m b√†i ki·ªÉm tra n√†y.</p>
        </div>

        <div class="certificate-wrapper" *ngIf="isAllLessonsCompleted()">
            <h2 class="certificate-wrapper-title">Ch·ª©ng nh·∫≠n ho√†n th√†nh kho√° h·ªçc</h2>
            <p class="certificate-wrapper-text">B·∫°n ƒë√£ nh·∫≠n ƒë∆∞·ª£c gi·∫•y ch·ª©ng nh·∫≠n ho√†n th√†nh kh√≥a h·ªçc sau khi ho√†n th√†nh 100% n·ªôi dung kh√≥a h·ªçc.</p>
            <div #certificateContainer class="certificate-container">
                <canvas #certificateCanvas width="750" height="563"></canvas>
                <div class="certificate-logo">
                    <img src="../../../../assets/images/logo.png" alt="Logo" />
                </div>
                <div class="certificate-title1">GI·∫§Y CH·ª®NG NH·∫¨N</div>
                <div class="certificate-title">CERTIFICATE OF COMPLETION</div>
                <div class="certificate-recipient">{{ studentName }}</div>
                <div class="certificate-reason">ƒê√£ ho√†n th√†nh kho√° h·ªçc "{{ course?.title }}"</div>
                <div class="certificate-footer">
                    <div class="certificate-signature">{{ currentDate }}</div>
                    <div class="certificate-sign">
                        <img src="../../../../assets/images/chu_ky.png" alt="Ch·ªØ k√Ω" />
                    </div>
                </div>
                <div class="certificate-email">{{ studentEmail }}</div>
            </div>
            <button nz-button nzType="primary" class="download-certificate-btn" (click)="downloadCertificate()">
                T·∫£i xu·ªëng ch·ª©ng ch·ªâ
            </button>
            
        </div>
    </div>
</div>

