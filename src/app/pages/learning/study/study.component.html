<nz-layout>
    <nz-sider class="menu-sidebar" nzCollapsible nzWidth="256px" nzBreakpoint="md" [(nzCollapsed)]="isCollapsed"
        [nzTrigger]="null" nzTheme="light">
        <ul nz-menu nzTheme="light" nzMode="inline" [nzInlineCollapsed]="isCollapsed">
            <li nz-submenu nzOpen nzTitle="Danh s√°ch b√†i h·ªçc" nzIcon="book">
                <ul>
                    <li *ngFor="let lesson of lessons" nz-menu-item (click)="selectLesson(lesson)">
                        <div class="lesson-item">
                            <span class="lesson-title">{{ lesson.title }}</span>
                            <nz-icon nzType="check-circle" [nzTheme]="'outline'" [ngClass]="{'completed-icon': lessonProgress[lesson.lessonId] === 100, 
                                            'pending-icon': lessonProgress[lesson.lessonId] !== 100}">
                            </nz-icon>
                        </div>
                    </li>
                </ul>
            </li>
        </ul>
        <button *ngIf="!isCollapsed && isAllLessonsCompleted" (click)="goToExam()" class="exam-btn">
            L√†m b√†i ki·ªÉm tra
        </button>
    </nz-sider>

    <!-- Layout ch√≠nh -->
    <nz-layout>
        <!-- Header -->
        <nz-header class="app-header">
            <span class="header-trigger" (click)="isCollapsed = !isCollapsed">
                <nz-icon [nzType]="isCollapsed ? 'menu-unfold' : 'menu-fold'" class="trigger"
                    nzTheme="outline"></nz-icon>
            </span>
            <h2 class="header-title">Trang H·ªçc T·∫≠p</h2>
        </nz-header>

        <!-- N·ªôi dung ch√≠nh -->
        <nz-content class="app-content">
            <div class="content-wrapper">
                <div *ngIf="selectedLesson">
                    <!-- ‚úÖ N·ªôi dung b√†i h·ªçc -->
                    <div class="lesson-container">
                        <h3>{{ selectedLesson.title }}</h3>
                        <div *ngFor="let item of lessonContent">
                            <ng-container [ngSwitch]="item.mediaType">
                                <p *ngSwitchCase="'text'" style="white-space: pre-line;" class="lesson-text">{{
                                    item.content }}</p>
                                <img *ngSwitchCase="'image'" [src]="item.mediaUrl" alt="H√¨nh ·∫£nh b√†i h·ªçc" width="500">
                                <app-video-player *ngSwitchCase="'video'" [src]="item.mediaUrl || ''" [width]="'1000'"
                                    [height]="'500'" [controls]="true">
                                </app-video-player>
                                <p *ngSwitchDefault>Lo·∫°i n·ªôi dung kh√¥ng h·ªó tr·ª£.</p>
                            </ng-container>
                        </div>
                    </div>

                    <!-- ‚úÖ B√†i t·∫≠p & C√¢u h·ªèi -->
                    <div class="exercise-container">
                        <div class="assignment-container" *ngIf="assignment; else noAssignment">
                            <h1>üìå B√ÄI T·∫¨P</h1>
                            <h2>T√™n b√†i t·∫≠p: {{ assignment.title }}</h2>
                            <p><strong>M√¥ t·∫£:</strong> {{ assignment.description }}</p>
                        </div>

                        <!-- N·∫øu kh√¥ng c√≥ b√†i t·∫≠p -->
                        <ng-template #noAssignment>
                            <p>Kh√¥ng c√≥ b√†i t·∫≠p n√†o ƒë∆∞·ª£c t√¨m th·∫•y.</p>
                        </ng-template>

                        <div class="questions" *ngIf="questions.length > 0">
                            <h4>C√¢u h·ªèi</h4>
                            <div *ngFor="let question of questions" [ngSwitch]="question.type" class="question-card">
                                <!-- C√¢u h·ªèi tr·∫Øc nghi·ªám -->
                                <div *ngSwitchCase="1">
                                    <p><strong>{{ question.text }}</strong></p>
                                    <ul>
                                        <li *ngFor="let answer of question.answers">
                                            <label>
                                                <input type="radio" [name]="'question_' + question.id"
                                                    [value]="answer.id" [(ngModel)]="question.selectedAnswer"
                                                    (change)="onAnswerSelect(question.id, answer.id)">
                                                <span>{{ answer.text }}</span>
                                            </label>
                                        </li>

                                    </ul>
                                </div>

                                <!-- C√¢u h·ªèi ƒëi·ªÅn t·ª´ -->
                                <div *ngSwitchCase="2" class="fill-in-the-blank">
                                    <p><strong>{{ question.text.replace('_', '__') }}</strong></p>
                                    <input type="text" [(ngModel)]="question.userAnswer" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi">
                                </div>
                            </div>

                            <!-- N√∫t n·ªôp b√†i -->
                            <button class="submit-button" (click)="submitAssignment()">N·ªôp b√†i</button>
                        </div>

                        <!-- Hi·ªÉn th·ªã th√¥ng b√°o n·∫øu kh√¥ng c√≥ c√¢u h·ªèi -->
                        <p *ngIf="questions.length === 0">Kh√¥ng c√≥ c√¢u h·ªèi n√†o cho b√†i t·∫≠p n√†y.</p>
                    </div>


                </div>
            </div>
        </nz-content>
    </nz-layout>
</nz-layout>